var app=new Vue({el:"#app",data:{accountId:"",ads:"",icon:"",name:"",nickName:"",qq:"",sex:"",signature:"",telphone:"",uid:""},methods:{getuserdata:function(){app.uid&&$.ajax({type:"POST",url:"/api/userdata",data:{uid:app.uid},success:function(a){try{app.name=a.data.name,app.sex=a.data.sex,app.ads=a.data.address,app.qq=a.data.qq,app.phone=a.data.telphone,app.nickName=a.data.nickName,app.accountId=a.data.accountId,app.icon=a.data.icon}catch(e){}}})},submituserdata:function(){if(app.accountId){var a=app.nickName,e=app.sex,t=app.ads,n=app.qq,i=app.phone,d=app.name;$.ajax({type:"POST",url:"/api/subuserdata",data:{uid:app.uid,id:app.accountID,nickName:a,sex:e,address:t,qq:n,telphone:i,name:d,icon:app.icon},success:function(a){if("error_goto_user"==a)return alert("登录出现异常，请重新登录！"),util.delCookie("squid"),util.delCookie("token"),util.delCookie("accountId_shequ"),setTimeout(function(){location.href="/users"},1e3),!1;try{200==a.resultCode&&(alert("修改成功！"),location.href="/usercenter")}catch(e){}}})}},AjaxImgLoad:function(a,e){$.ajax({type:"post",url:"https://staging-uploadimg.lemonade-game.com/ema-dingding/upload",data:{fileName:a,file:e+""},success:function(a){try{console.log(a.data);var e=a.data,t=e.split("code=")[1];e="https://staging-uploadimg.lemonade-game.com/ema-dingding/download?code="+t,app.icon=e,app.submituserdata()}catch(n){}}})}}});app.uid=util.getCookie("squid"),app.getuserdata(),$(document).ready(function(){$("#avatarInput").on("change",function(a){var e=5120,t=$(a.target),n=t[0].files[0].size/1024;if(n>e)return alert("图片过大，请重新选择!"),$(".avatar-wrapper").childre().remove,!1;if(this.files[0].type.match(/image.*/)){var i=document.querySelector("#avatar-name"),d=document.querySelector("#avatarInput").value,o=d;testend=o.match(/[^\\]+\.[^\(]+/i),i.innerHTML=testend}else alert("请选择正确的图片!")}),$(".avatar-save").on("click",function(){var a=document.getElementById("imageHead");html2canvas(a,{allowTaint:!0,taintTest:!1,onrendered:function(a){a.id="mycanvas";var e=a.toDataURL("image/jpeg"),t=document.createElement("img");t.src=e;var n=$("#avatar-name").html(),i=$("#imageHead").html();i?app.AjaxImgLoad(n,e):alert("请先上传图片！")}})})});