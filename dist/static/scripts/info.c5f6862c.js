function getCookie(e){for(cookie_name=e+"=",cookie_length=document.cookie.length,cookie_begin=0;cookie_begin<cookie_length;){if(value_begin=cookie_begin+cookie_name.length,document.cookie.substring(cookie_begin,value_begin)==cookie_name){var t=document.cookie.indexOf(";",value_begin);return t==-1&&(t=cookie_length),decodeURIComponent(document.cookie.substring(value_begin,t))}if(cookie_begin=document.cookie.indexOf(" ",cookie_begin)+1,0==cookie_begin)break}return null}var app=new Vue({el:"#app",data:{isActive:4,uid:0,server:0,battleList:[],userInfo:{},userheros:{},showAll:!1,roleid:"",allMatch:{},battle:[],source:"",curPage:1,pageSize:20,isEnd:!1,rank:"",myrank:"",desc:"一起来查看你在次元的战绩",infoserver:"",inforole:"",inforoleid:""},methods:{changeTab:function(e){app.isActive=e},getUrlParams:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=decodeURI(window.location.search).substr(1).match(t);return null!=a?unescape(a[2]):null},getBattle:function(){$("#loadingToast").show(),app.uid?$.ajax({type:"POST",url:"/api/getBattle",data:{uid:app.uid},success:function(e){app.battleList=e.data,$("#loadingToast").hide(),!app.battleList||0==app.battleList.length},error:function(e){$("#loadingToast").hide()}}):$("#loadingToast").hide()},getMapDictionary:function(){$.ajax({type:"POST",url:"/api/getMapDictionary",success:function(e){app.battleList=e.data},error:function(e){console.log(e)}})},selectUserRealData:function(){app.uid?$.ajax({type:"POST",url:"/api/selectUserRealData",data:{uid:app.uid},success:function(e){},error:function(e){console.log(e)}}):app.userInfo={rateOfWin:"0",elo:"0",battleNum:"0"}},getUserData:function(){$(".detail-list").hide(),$(".no_match").hide();var e=util.getCookie("suid");"other"==other||(e?(app.uid=util.getCookie("suid"),app.server=util.getCookie("sserver"),app.source=util.getCookie("ssource")):(app.server=util.getCookie("sserver"),app.source=util.getCookie("ssource"),$(".sendlottery").show())),app.uid?$.ajax({type:"POST",url:"/api/getUserData",data:{uid:app.uid,server:app.server,source:app.source},success:function(e){if(null==e)return setTimeout(function(){$(".match").show(),$(".no_match").show(),$("#loadingToast").hide(),$(".detail-list").hide(),$(".sendlottery ").removeClass("bounceOutDown"),$(".sendlottery ").addClass("bounceOutDown"),setTimeout(function(){$(".sendlottery ").hide()},1e3)},200),app.userInfo={rateOfWin:0,battileFailNum:0,battileWinNum:0},!1;setTimeout(function(){$(".match").show(),$("#loadingToast").hide(),$(".detail-list").show(),$(".sendlottery ").removeClass("bounceOutDown"),$(".sendlottery ").addClass("bounceOutDown"),util.setCookie("suid",app.uid),setTimeout(function(){$(".sendlottery ").hide()},1e3)},200);try{app.userInfo=e.data;var t=(app.userInfo.battileWinNum/(app.userInfo.battileWinNum+app.userInfo.battileFailNum)).toFixed(3);app.ctx_win("ctx-win",t),app.ctx_changci("ctx-win1",app.userInfo.battileWinNum+app.userInfo.battileFailNum),util.setCookie("infoname",app.userInfo.name),app.roleid=app.userInfo.roleId,app.getRadar(),app.myrankfun()}catch(a){}""!=app.roleid&&(app.getUserDataBattle(),app.getUserHeroBattleData(app.roleid))},error:function(e){console.log(e),$(".match").show(),$(".no_match").show(),$("#loadingToast").hide(),app.userInfo={rateOfWin:"0",battileFailNum:0,battileWinNum:0}}}):(app.userInfo={rateOfWin:"0",battileFailNum:0,battileWinNum:0},$(".match").show(),$(".no_match").show(),$("#loadingToast").hide())},getUserDataBattle:function(){$("#loadingToast").show(),app.uid?$.ajax({type:"POST",url:"/api/getUserDataBattle",data:{uid:app.uid,server:app.server,roleId:app.roleid,curPage:app.curPage||1,pageSize:app.pageSize||20},success:function(e){app.battle=app.battle.concat(e.data),e.count<=app.curPage*app.pageSize&&(app.isEnd=!0),app.curPage++,setTimeout(function(){$(".match").show(),$(".no_match").hide(),$("#loadingToast").hide(),$(".detail-list").show()},200)},error:function(e){$(".match").show(),$("#loadingToast").hide()}}):(app.userInfo={rateOfWin:"0",elo:"0",battleNum:"0"},$(".match").show(),$(".no_match").show(),$("#loadingToast").hide())},getUserHeroBattleData:function(e){$.ajax({type:"POST",url:"/api/getUserHeroBattleData",data:{roleId:e},success:function(e){app.userheros=e.data},error:function(e){console.log(e)}})},selectUserHeroKDAStatisticsTest:function(){app.uid?$.ajax({type:"POST",url:"/api/selectUserHeroKDAStatisticsTest",data:{uid:app.uid},success:function(e){200==e.resultCode?app.allMatch=e:alert("网络错误！")},error:function(e){console.log(e)}}):app.userInfo={rateOfWin:"0",elo:"0",battleNum:"0"}},rankingList:function(){$.ajax({type:"POST",url:"/api/getUserBattleRankingList",success:function(e){app.rank=e.data},error:function(e){console.log(e)}})},changeShowAll:function(){app.showAll=!app.showAll},show_myrecord:function(){$(".my-heros").hide(),$(".paihang").hide(),$(".my-record").show()},show_myheros:function(){$(".my-heros").show(),$(".my-record").hide(),$(".paihang").hide()},show_paihang:function(){$(".my-heros").hide(),$(".my-record").hide(),$(".paihang").show()},registerclick:function(){$(".infobar .bars").click(function(){$(this).addClass("bars-active").siblings(".bars").removeClass("bars-active"),$(".bars img").removeClass("box-shadow"),$(this).find("img").addClass("box-shadow");var e=$(this).find("p").html();"基本数据"==e?($("#basic-info").show(),$("#radar").hide()):($("#basic-info").hide(),$("#radar").show())})},three_combat:function(e){var t=echarts.init(document.getElementById("three-combat")),a={title:{text:""},tooltip:{},legend:{orient:"horizontal",x:"right",y:"top",itemGap:10,top:"0px;"},radar:{indicator:[{name:"金币"+e.avgTotalMoney.toFixed(1),max:100},{name:"输出\n"+e.avgDamageTotal.toFixed(1),max:100},{name:"生存"+e.avgBeKilledCount.toFixed(1),max:100},{name:"助攻"+e.avgAssistCount.toFixed(1),max:100},{name:"KDA\n"+e.avgKDA.toFixed(1),max:100},{name:"综合"+e.avgAll.toFixed(1),max:100}],startAngle:120,radius:"60%"},series:[{name:"战绩图",type:"radar",data:[{value:[e.avgTotalMoney,e.avgDamageTotal,e.avgBeKilledCount,e.avgAssistCount,e.avgKDA,e.avgAll],name:"近20场"}],itemStyle:{normal:{color:"rgb(51, 153, 254)",fontsize:"12px",label:{show:!1}}}}]};t.setOption(a)},ctx_win:function(e,t){var a=document.getElementById(e);if(a.getContext){var o=a.getContext("2d");o.beginPath(),o.strokeStyle="rgba(160, 148, 141, 0.51)",o.lineWidth=40,o.font="100px Arial",o.textAlign="center",o.fillText((100*t).toFixed(1)+"%",360,400);var i={x:360,y:360,r:300};o.arc(i.x,i.y,i.r,0,2*Math.PI,!1),o.stroke(),o.beginPath();var r=o.createLinearGradient(500,50,0,460);r.addColorStop("0","#846779"),r.addColorStop("1.0","#ff610f"),o.strokeStyle=r,o.lineWidth=40;var i={x:360,y:360,r:300};o.arc(i.x,i.y,i.r,1.5*Math.PI,1.5*Math.PI+Math.PI*t*2,!1),o.stroke()}},ctx_changci:function(e,t){var a=document.getElementById(e);if(a.getContext){var o=a.getContext("2d");o.beginPath(),o.strokeStyle="rgba(160, 148, 141, 0.51)",o.lineWidth=40,o.font="100px Arial",o.textAlign="center",o.fillText(t,360,400);var i={x:360,y:360,r:300};o.arc(i.x,i.y,i.r,0,2*Math.PI,!1),o.stroke()}},ctx_zonghe:function(e,t){var a=document.getElementById(e);if(a.getContext){var o=a.getContext("2d");o.beginPath(),o.strokeStyle="rgba(160, 148, 141, 0.51)",o.lineWidth=40,o.font="100px Arial",o.textAlign="center",o.fillText(t.toFixed(1),360,400);var i={x:360,y:360,r:300};o.arc(i.x,i.y,i.r,0,2*Math.PI,!1),o.stroke(),o.beginPath();var r=o.createLinearGradient(500,50,0,460);r.addColorStop("0","#846779"),r.addColorStop("1.0","#ff610f"),o.strokeStyle=r,o.lineWidth=40;var i={x:360,y:360,r:300};o.arc(i.x,i.y,i.r,1.5*Math.PI,1.5*Math.PI+Math.PI*(t/100)*2,!1),o.stroke()}},getRadar:function(){app.roleid&&$.ajax({type:"POST",url:"/api/getUserBattleAvgData",data:{roleId:app.roleid},success:function(e){try{app.three_combat(e.data.data),app.ctx_zonghe("ctx-win2",e.data.data.avgAll)}catch(t){}},error:function(e){console.log(e)}})},WXshare:function(){var e=app.getDevice(),t=encodeURIComponent(location.href.split("#")[0]);$.ajax({type:"POST",url:"/api/shareaddSign",data:{appId:"20019",url:t,appKey:"71599476762ca9835879f4d188919549",allianceId:e},success:function(e){e&&0==e.status&&wx.config({debug:!1,appId:"wx90ea8be0c05b9630",timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,signature:e.data.signature,jsApiList:["onMenuShareQZone","checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","getNetworkType","hideOptionMenu","showOptionMenu","closeWindow","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","scanQRCode","chooseWXPay"]}),wx.ready(function(){var e=getCookie("squid"),t=getCookie("sserver"),a=getCookie("ssource"),o=location.href.split("?")[0],i=location.href.split("/users")[0]+"/static/imgs_static/share/sharelogo.png",r={title:"次元战绩分享",desc:app.desc,link:o+"?uid="+e+"&server="+t+"&source="+a+"&WXshare=fromwx&&otherps=other",imgUrl:i,type:"link",dataUrl:"",success:function(){$(".sharemask").hide(),app.shareBattleSendLottery()},cancel:function(){}};wx.onMenuShareQZone(r),wx.onMenuShareAppMessage(r),wx.onMenuShareTimeline(r),wx.onMenuShareQQ(r)})},error:function(e){console.log(e)}})},getDevice:function(){var e=navigator.userAgent,t=e.indexOf("Android")>-1||e.indexOf("Adr")>-1,a=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);return t?(app.channelTag=1001,"26"):a?(app.channelTag=0,"71"):(app.channelTag=1001,"26")},formWX:function(){var e=app.getUrlParams("WXshare");if("fromwx"==e)for(var t=$(".weui-tabbar a"),a=1;a<t.length;a++)t.eq(a).attr("href","/users/sharefuli")},showbangData:function(e,t){t&&$.ajax({type:"POST",url:"/api/getUserDataByRoleId",data:{roleId:t},success:function(t){try{t.data&&(location.href="/users/info?uid="+t.data.accountUid+"&server="+e+"&source="+t.data.source+"&otherps=other")}catch(a){}},error:function(e){console.log(e)}})},myrankfun:function(){$.ajax({type:"POST",url:"/api/getUserBattleRankingByRoleId",data:{roleId:app.roleid},success:function(e){try{Number(e.data.orderNum)<=1e3?(app.myrank="你的当前名次："+e.data.orderNum,app.uid==util.getCookie("suid")&&(app.desc="我在次元本周综合实力排行中取得了第"+e.data.orderNum+"名, 一起来查看你在次元的战绩")):(app.myrank="未上榜",app.desc=" 一起来查看你在次元的战绩")}catch(t){app.myrank="未上榜",app.desc=" 一起来查看你在次元的战绩"}},error:function(e){console.log(e)}})},transToken:function(e,t,a){$.ajax({type:"POST",url:"/api/getChangeToken",data:{uid:e,appId:t,token:a},success:function(e){try{200==e.resultCode&&util.setCookie("token",e.data.token)}catch(t){}},error:function(e){console.log(e)}})},shareBattleSendLottery:function(){$.ajax({type:"POST",url:"/api/shareBattleSendLottery",data:{key:"zhanji"},success:function(e){}})},selectServerPage:function(){},getServer:function(){$.ajax({type:"POST",url:"/api/getServer",success:function(e){$("#select-server-role").html("");try{for(var t=e.serverList,a='<option value="-1">请选择大区</option>',o=0;o<t.length;o++){switch(t[o].serverName){case"天使之门":t[o].serverKey="23000";break;case"天空之城":t[o].serverKey="23002";break;case"绯红暴君":t[o].serverKey="23003"}a=a+"<option value="+t[o].serverKey+">"+t[o].serverName+"</option>"}$("#select-server-role").html(a)}catch(i){}}})},getRole:function(e){return app.uid=getCookie("squid"),app.uid&&$.ajax({type:"POST",url:"/api/getRole",async:!1,data:{uid:app.uid,server:void 0==e?app.infoserver:e},success:function(e){app.inforole=e.data;try{setTimeout(function(){$("#select-role option:eq(1)").prop("selected",!0)},10)}catch(t){}}}),app.inforole},changeServer:function(){$("#select-server-role").change(function(){if(app.infoserver=$("#select-server-role").val(),"-1"!=app.infoserver){var e=app.getRole();console.log(e),setTimeout(function(){e.length>0&&(app.inforoleid=$("#select-role").val())},200)}else layer.alert("请先选择区服！"),$("#select-role").val("1")})}}});app.uid=app.getUrlParams("uid"),app.server=app.getUrlParams("server"),app.source=app.getUrlParams("source");var other=app.getUrlParams("otherps"),showbottom=app.getUrlParams("showbottom");if(0==showbottom?(util.setCookie("showbottom","hide"),$("#go-to-fuli").hide(),$("#select-server").hide(),$("#sharebtn").hide()):($("#go-to-fuli").show(),$("#select-server").show()),"hide"==util.getCookie("showbottom"),null!=app.uid&&null!=app.server&&app.source);else if(0==showbottom){app.source=app.getDevice();try{app.uid=getCookie("uid"),app.server=getCookie("zoneId");var token=getCookie("token");util.setCookie("suid",app.uid),util.setCookie("sserver",app.server),util.setCookie("ssource",app.source),util.setCookie("squid",app.uid),app.transToken(app.uid,"20015",token)}catch(e){alert("获取cookie失败！")}}app.getUserData(),app.rankingList(),app.WXshare(),app.formWX(),app.getServer(),app.changeServer(),$("#show-myheros").click(function(){app.show_myheros(),$("#11").show(),$("#12").hide(),$("#21").hide(),$("#22").show(),$("#31").hide(),$("#32").show()}),$("#show-myrecord").click(function(){app.show_myrecord(),$("#11").hide(),$("#12").show(),$("#21").show(),$("#22").hide(),$("#31").hide(),$("#32").show()}),$("#show-paihang").click(function(){app.show_paihang(),$("#11").hide(),$("#12").show(),$("#21").hide(),$("#22").show(),$("#31").show(),$("#32").hide()}),$("#sever-select").change(function(){app.server=$("#sever-select").val(),app.getUserData()}),$("#go-to-fuli").click(function(){location.href="/active/active"}),app.registerclick(),$(document).ready(function(){$("#sharebtn").click(function(){$(".sharemask").show()}),$(".shareclose").click(function(){$(".sharemask").hide()}),$("#gainingmask .gbtn1").click(function(){$(".sendlottery").hide()}),$("#select-server").click(function(){$(".sendlottery ").removeClass("bounceOutDown"),$(".sendlottery").show()}),$("#gainingmask .gbtn").click(function(){util.setCookie("sserver",$("#select-server-role").val()),util.setCookie("ssource",$("#select-role").val()),$(".sendlottery").hide(),app.curPage=1,app.getUserData()})});