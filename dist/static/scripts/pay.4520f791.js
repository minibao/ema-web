var addS=new Vue({el:"#addS",data:{uid:"",token:"",gameTransCode:"",appId:"20019",pid:"NM_0001",quantity:"1",appKey:"71599476762ca9835879f4d188919549",sign:"",orderId:"",productInfo:"",orderInfo:"",timestamp:"",app_id:"2016070901596612",accountId:"",biz_content:"",arrparams:"",notifyurl:"",paytype:"weixin"},methods:{getuserdata:function(){addS.uid&&$.ajax({type:"POST",url:"/api/userdata",data:{uid:addS.uid},success:function(d){try{addS.accountId=d.data.accountId,addS.accountId||(layer.msg("去个人中心添加昵称"),setTimeout(function(){location.href="/usercenter?accound=kong"},1500))}catch(a){}}})},createOrderSociety:function(){addS.uid&&$.ajax({type:"POST",url:"/api/createOrderData",data:{uid:addS.uid,appId:addS.appId,token:addS.token,pid:addS.pid,quantity:addS.quantity,appKey:addS.appKey,accountId:addS.accountId},success:function(d){try{addS.gameTransCode=d.data.orderId,addS.timestamp=d.data.time,addS.createOrder()}catch(a){}}})},createOrder:function(){addS.uid&&$.ajax({type:"POST",url:"/api/createOrder",data:{uid:addS.uid,appId:addS.appId,token:addS.token,pid:addS.pid,quantity:addS.quantity,gameTransCode:addS.gameTransCode,appKey:addS.appKey},success:function(d){try{"error_goto_user"==d&&(layer.msg("登录出现异常，请重新登录！"),util.delCookie("squid"),util.delCookie("token"),util.delCookie("accountId_shequ"),layer.msg("检测到帐号异常，请重新登录！"),setTimeout(function(){location.href="/users"},1e3)),d.data.orderId&&(addS.orderId=d.data.orderId,addS.productInfo=d.data.productInfo,addS.addSign())}catch(a){}}})},addSign:function(){var d=$("#jingying_num").val();d=util.trim(d),""==d&&(d=1);var a={body:addS.productInfo.description,subject:"福利社-"+100*Number(addS.quantity)+"柠檬点",out_trade_no:addS.orderId,timeout_express:"90m",total_amount:d,product_code:"NM_0001"};a=JSON.stringify(a),notify="https://platform.lemonade-game.com/ema-platform/alipay/notifycallbackWeb",adds.notifyurl=util.getlocalhostPath();var t=adds.notifyurl+"/usercenter?ispaybuy=ok";addS.orderInfo="app_id=2016070901596612&biz_content="+a+"&charset=utf-8&method=alipay.trade.wap.pay&notify_url="+notify+"&return_url="+t+"&sign_type=RSA&timestamp="+addS.timestamp+"&version=1.0",$.ajax({type:"POST",url:"/api/addSign",data:{uid:addS.uid,appId:addS.appId,orderInfo:addS.orderInfo,token:addS.token,orderId:addS.orderId},success:function(d){try{d.data&&(console.log(d.data),addS.sign=d.data,addS.openAlipay())}catch(a){console.log(a)}}})},openAlipay:function(){console.log("https://openapi.alipay.com/gateway.do?"+addS.sign),location.href="https://openapi.alipay.com/gateway.do?"+addS.sign}}});addS.uid=util.getCookie("squid"),addS.token=util.getCookie("token"),addS.getuserdata(),$(document).ready(function(){$("#zhifubao").click(function(){addS.accountId&&(addS.quantity=$("#jingying_num").val(),addS.quantity=util.trim(addS.quantity),""==addS.quantity&&(addS.quantity=1),addS.paytype="zhifubao",addS.createOrderSociety())}),$("#zhima").click(function(){layer.msg("暂未开放")})}),$("#payid").click(function(){document.forms.alipaysubmit.submit()});