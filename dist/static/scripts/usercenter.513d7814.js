var app=new Vue({el:"#app",data:{uid:"",server:"",roleid:"",role:"",accountID:"",uinfo:{},sex:"",describe:"",winlist:"",winid:"",count_unsend:0,sserver:"",ssource:"",binfo:"",Ecard:"",appId:"20019",desc:"玩游戏兑换京东E卡/Q币卡,现金奖品拿到手软",icon:"",rotateFlag:0,base64:"",filename:"",blob:"",file:"",o:""},methods:{getuserdata:function(){app.uid&&$.ajax({type:"POST",url:"/api/userdata",data:{uid:app.uid},success:function(e){try{if(app.uinfo=e.data,app.uinfo.nickName&&""!=app.uinfo.nickName?$("#name").val(app.uinfo.nickName):(uinfo.nickName=util.getCookie("infoname"),$("#name").val(util.getCookie("infoname"))),$("#phone").val(app.uinfo.telphone),$("#QQ").val(app.uinfo.qq),$("#ads").val(app.uinfo.address),$("#Rname").val(app.uinfo.name),""==app.uinfo.icon||null==app.uinfo.icon){var a=util.getlocalhostPath()+"/static/imgs_static/icon/head.png";$("#cl-img-input").attr("src",a);var n=$("#cl-img-input").width();$("#cl-img-input").css("height",n+"px")}else console.log(app.uinfo.icon),$.ajax({type:"post",url:app.uinfo.icon,success:function(e){try{$("#cl-img-input").attr("src",e);var a=$("#cl-img-input").width();$("#cl-img-input").css("height",a+"px")}catch(n){}}});app.accountID=app.uinfo.accountId,util.setCookie("accountId_shequ",app.accountID),app.sex=app.uinfo.sex,app.describe=app.uinfo.signature,1==app.sex?($("#girl").hide(),$("#boy").show()):(app.sex=2)&&($("#girl").show(),$("#boy").hide()),null!=app.uinfo.accountId&&""!=app.uinfo.accountId||($(".layui-layer-btn1").hide(),layer.prompt({title:"请修改你的昵称,昵称不能为空！"},function(e,a){console.log(e),""==e||null==e||layer.close(a)})),""!=app.describe&&app.describe&&$("#info-describe").html(app.describe),app.getUserWinningList(),app.getuserinfo()}catch(i){var a=util.getlocalhostPath()+"/static/imgs_static/icon/head.png";$("#cl-img-input").attr("src",a),app.uinfo={},app.uinfo.nickName=util.getCookie("infoname"),$("#name").val(util.getCookie("infoname"))}}})},getuserinfo:function(){app.accountID&&$.ajax({type:"POST",url:"/api/active_getinfo",data:{accountId:app.accountID},success:function(e){try{app.binfo=e.data}catch(a){}}})},submituserdata:function(){if(app.uid){var e=$("#name").val(),a=app.sex,n=$("#ads").val(),i=$("#QQ").val(),t=$("#phone").val(),o=$("#Rname").val();if(!checkPhone(t))return layer.msg("手机格式有误！"),!1;if(!e)return layer.msg("请填写昵称！"),!1;if(console.log(e.length),e.length>10)return layer.msg("昵称不得超过10个字符！"),!1;if(!o)return layer.msg("请填写真实姓名！"),!1;if(o.length>5)return layer.msg("姓名过长！"),!1;!app.icon,$("#name").change(function(){return!1}),$.ajax({type:"POST",url:"/api/subuserdata",data:{uid:app.uid,id:app.accountID,nickName:e,sex:a,address:n,qq:i,telphone:t,name:o,icon:app.icon},success:function(e){if("error_goto_user"==e)return layer.msg("登录出现异常，请重新登录！"),util.delCookie("squid"),util.delCookie("token"),util.delCookie("accountId_shequ"),setTimeout(function(){location.href="/users"},1e3),!1;try{console.log(e),$("#iosDialog2 .weui-dialog__bd").html(e.resultMsg+"!"),$("#iosDialog2").show(),app.getuserdata()}catch(a){}}})}},getUserWinningList:function(){""!=app.accountID?$.ajax({type:"POST",url:"/api/getUserWinningList",data:{accountId:app.accountID},success:function(e){try{app.count_unsend=0,app.winlist=e.data,""!=e.lastSendCardName&&(app.desc="我拿到了"+e.lastSendCardName+", 现金奖品拿到手软");for(var a=0;a<e.data.length;a++)"0"==e.data[a].isSend&&(app.count_unsend=app.count_unsend+1)}catch(n){}}}):console.log("accountID为空！")},getServer:function(){$.ajax({type:"POST",url:"/api/getServer",success:function(e){$("#select-server").html("");try{for(var a=e.serverList,n='<option value="-1">请选择大区</option>',i=0;i<a.length;i++){switch(a[i].serverName){case"天使之门":a[i].serverKey="23000";break;case"天空之城":a[i].serverKey="23002";break;case"绯红暴君":a[i].serverKey="23003"}n=n+"<option value="+a[i].serverKey+">"+a[i].serverName+"</option>"}$("#select-server").html(n),$("#select-server").val(app.sserver),app.getRole(app.sserver)}catch(t){}}})},getRole:function(e){return app.uid&&$.ajax({type:"POST",url:"/api/getRole",async:!1,data:{uid:app.uid,server:void 0==e?app.server:e},success:function(e){app.role=e.data;try{setTimeout(function(){$("#select-role").val(app.ssource)},10)}catch(a){}}}),app.role},changeServer:function(){$("#select-server").change(function(){if(app.server=$("#select-server").val(),"-1"!=app.server){var e=app.getRole();console.log(e),setTimeout(function(){e.length>0&&(app.roleid=$("#select-role").val())},200)}else layer.alert("请先选择区服！"),$("#select-role").val("1")})},sendGamePrize:function(e){return app.server=$("#select-server").val(),app.server&&""!=app.server?(app.allianceId=$("#select-role").val(),app.allianceId&&""!=app.allianceId?(app.roleid=$("#select-role ").find("option:selected").attr("roleid"),app.roleid&&""!=app.roleid?void(""!=app.winningid&&$.ajax({type:"POST",url:"/api/sendGamePrize",data:{server:app.server,allianceId:app.allianceId,roleId:app.roleid,winningId:e,accountId:app.accountID},success:function(e){if("error_goto_user"==e)return layer.msg("登录出现异常，请重新登录！"),util.delCookie("squid"),util.delCookie("token"),util.delCookie("accountId_shequ"),setTimeout(function(){location.href="/users"},1e3),!1;try{console.log(e),200==e.resultCode?($(".sendlottery").hide(),setTimeout(function(){layer.msg(e.resultMsg),app.getUserWinningList()},200)):($(".sendlottery").hide(),layer.msg(e.resultMsg),app.getUserWinningList())}catch(a){$(".sendlottery").hide(),layer.msg(e.resultMsg),app.getUserWinningList()}}})):(layer.msg("请选择角色2"),!1)):(layer.msg("请选择角色1"),!1)):(layer.msg("请选择区服"),!1)},swicthNingMeng:function(e){var a="";1==e?a="1200柠檬点兑换10元京东卡！":2==e&&(a="1200柠檬点兑换10Q币！"),layer.confirm(a,{skin:"my-class",title:"温馨提示",btn:["确定","取消"],closeBtn:0,anim:4},function(){app.accountID&&(app.Ecard=e,$.ajax({type:"POST",url:"/api/nmExchangeCard",async:!1,data:{accountId:app.accountID,prizeId:app.Ecard},success:function(e){return"error_goto_user"==e?(layer.msg("登录出现异常，请重新登录！"),util.delCookie("squid"),util.delCookie("token"),util.delCookie("accountId_shequ"),setTimeout(function(){location.href="/users"},1e3),!1):void(200==e.resultCode?(layer.msg(e.resultMsg),app.getuserinfo()):layer.msg(e.resultMsg))}}))},function(){})},swicthNingMeng2:function(e){var a="";11==e&&(a="100柠檬点兑换福利券礼包！"),layer.confirm(a,{skin:"my-class",title:"温馨提示",btn:["确定","取消"],closeBtn:0,anim:4},function(){app.accountID&&(app.Ecard=e,$.ajax({type:"POST",url:"/api/nmExchangeLottery",async:!1,data:{accountId:app.accountID,prizeId:app.Ecard},success:function(e){return"error_goto_user"==e?(layer.msg("登录出现异常，请重新登录！"),util.delCookie("squid"),util.delCookie("token"),util.delCookie("accountId_shequ"),setTimeout(function(){location.href="/users"},1e3),!1):void(200==e.resultCode?(layer.msg(e.resultMsg),app.getuserinfo()):"nmbz"==e.resultMsg?(layer.msg("柠檬点不足！"),setTimeout(function(){$(".addSenior").show()},500)):layer.msg(e.resultMsg))}}))},function(){})},registerclick:function(){$("#iosDialoghide").on("click",function(){$(".js_dialog").hide()}),app.sex=1,$(".right .seximg").click(function(){1==app.sex?app.sex=2:(app.sex=2)&&(app.sex=1),1==app.sex?($("#girl").hide(),$("#boy").show()):($("#girl").show(),$("#boy").hide())}),$("#info-describe").click(function(){$("#name").val(),$("#phone").val();$(".layui-layer-btn1").show(),layer.prompt({title:"个人描述添加(20字以内)"},function(e,a){console.log(e),""!=e&&null!=e?$.ajax({type:"POST",url:"/api/subuserdata",data:{uid:app.uid,id:app.accountID,nickName:app.uinfo.nickName,telphone:app.uinfo.telphone,sex:app.sex,signature:e},success:function(e){try{console.log(e),200==e.resultCode&&(layer.close(a),app.getuserdata())}catch(n){}}}):layer.close(a)})}),$(".infobar .bars").click(function(){$(this).addClass("bars-active").siblings(".bars").removeClass("bars-active"),$(".bars img").removeClass("box-shadow"),$(this).find("img").addClass("box-shadow");var e=$(this).find("p").html();"个人中心"==e?($(".lottery-list").hide(),$(".ningmeng").hide(),$(".user-info").show()):"柠檬兑换"==e?($(".user-info").hide(),$(".lottery-list").hide(),$(".ningmeng").show()):($(".user-info").hide(),$(".ningmeng").hide(),$(".lottery-list").show())}),$(document).ready(function(){$(".list-box").on("click",".lbtn",function(){var e=$(this),a=e.find("span").html();if("已领"==a)return layer.msg("该奖品已经被领取！"),!1;var n=e.attr("prizetype");"1"==n?$(".sendlottery1").show():"3"==n?($(".sendlottery3").show(),app.winid=e.attr("winningid")):($(".sendlottery").show(),app.winid=e.attr("winningid"))}),$(".sendlottery3 .gbtn").bind("click",function(){""!=app.winningid&&$.ajax({type:"POST",url:"/api/sendGamePrize",data:{server:"",allianceId:"",roleId:"",winningId:app.winid,accountId:app.accountID},success:function(e){if("error_goto_user"==e)return layer.msg("登录出现异常，请重新登录！"),util.delCookie("squid"),util.delCookie("token"),util.delCookie("accountId_shequ"),setTimeout(function(){location.href="/users"},1e3),!1;try{console.log(e),200==e.resultCode?($(".sendlottery3").hide(),setTimeout(function(){layer.msg(e.resultMsg),app.getUserWinningList()},200)):($(".sendlottery3").hide(),layer.msg(e.resultMsg),app.getUserWinningList())}catch(a){$(".sendlottery3").hide(),layer.msg(e.resultMsg),app.getUserWinningList()}}})}),$(".sendlottery3 .gbtn1").bind("click",function(){$(".sendlottery3").hide()}),$(".sendlottery .gbtn").bind("click",function(){var e=app.winid;app.sendGamePrize(e)}),$(".sendlottery .gbtn1").bind("click",function(){$(".sendlottery").hide()}),$(".sendlottery1 .gbtn").bind("click",function(){$(".sendlottery1").hide()}),$("#duihuanE").bind("click",function(){app.swicthNingMeng(1)}),$("#duihuanQ").bind("click",function(){app.swicthNingMeng(2)}),$("#duihuanFli").bind("click",function(){app.swicthNingMeng2(11)}),$("#showaddsenior").click(function(){app.swicthNingMeng2(11)})})},WXshare:function(){var e=app.getDevice(),a=encodeURIComponent(location.href.split("#")[0]);$.ajax({type:"POST",url:"/api/shareaddSign",data:{appId:app.appId,url:a,appKey:"71599476762ca9835879f4d188919549",allianceId:e},success:function(e){e&&0==e.status&&wx.config({debug:!1,appId:"wx90ea8be0c05b9630",timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,signature:e.data.signature,jsApiList:["onMenuShareQZone","checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","getNetworkType","hideOptionMenu","showOptionMenu","closeWindow","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","scanQRCode","chooseWXPay"]}),wx.ready(function(){var e=location.href.split("/usercenter")[0],a=location.href.split("/usercenter")[0]+"/static/imgs_static/share/sharelogo1.png",n={title:"玩游戏现金奖品等你来拿",desc:app.desc,link:e+"/users/sharefuli",imgUrl:a,type:"link",dataUrl:"",success:function(){$(".sharemask").hide(),app.shareBattleSendLottery()},cancel:function(){}};wx.onMenuShareQZone(n),wx.onMenuShareAppMessage(n),wx.onMenuShareTimeline(n),wx.onMenuShareQQ(n)})},error:function(e){console.log(e)}})},getDevice:function(){var e=navigator.userAgent,a=e.indexOf("Android")>-1||e.indexOf("Adr")>-1,n=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);return a?(app.channelTag=1001,"26"):n?(app.channelTag=0,"70"):(app.channelTag=1001,"26")},shareBattleSendLottery:function(){$.ajax({type:"POST",url:"/api/shareBattleSendLottery",data:{key:"fuli"},success:function(e){}})},getUserDataByToken:function(){$.ajax({type:"POST",url:"/api/getUserDataByToken",data:{},success:function(e){console.log(e)}})}}});app.getServer(),app.changeServer(),app.uid=util.getCookie("squid"),app.sserver=util.getCookie("sserver"),app.ssource=util.getCookie("ssource"),app.WXshare(),$("#jingying_num").val("6"),app.getUserDataByToken(),app.uid&&app.getuserdata(),$("#save").click(function(){app.submituserdata()}),$("#zhuxiao").click(function(){util.delCookie("squid"),util.delCookie("token"),util.delCookie("accountId_shequ");var e=util.getCookie("goto");"active1"==e?location.href="/users?goto=active1":location.href="/users"}),app.registerclick(),"show"==util.getCookie("showprize")?($(".infobar .bars").eq(1).trigger("click"),util.setCookie("showprize","hide")):null!=util.getUrlParams("sign")?setTimeout(function(){layer.msg("购买成功！")},1e3):"ok"==util.getUrlParams("showpay")&&$(".addSenior").show(),"hide"==util.getCookie("showbottom"),"ok"==util.getUrlParams("congzhi")&&$(".addSenior").show(),$(document).ready(function(){$("#sharebtn").click(function(){$(".sharemask").show()}),$(".shareclose").click(function(){$(".sharemask").hide()}),$("#Recharge").click(function(){$(".addSenior").show()}),$("#addS-close").click(function(){$(".addSenior").hide()}),$("#cl-img-input").click(function(){app.uinfo.telphone?location.href="/usercenter/upimg":layer.msg("请填写完整的个人信息")})});