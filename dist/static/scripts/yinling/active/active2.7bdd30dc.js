var app=new Vue({el:"#app",data:{uid:"",accountId:"",binfo:"",boxId:"11",prize10:"",duobaoflag:0,desc:"次元深海大和绝版皮肤,各种周边实物奖励等你来拿",congxinxipai:0,prizeDIV:"",prizeName:"",lotteryType:"",prizeList:""},methods:{init:function(){app.accountId=util.getCookie("accountId_shequ"),app.uid=util.getCookie("squid"),app.uid&&app.getuserdata(),app.accountId&&app.activeGetInfo(),app.getlrecentlylist_10(),app.getPrizeListData(),app.startPrize()},getuserdata:function(){$.ajax({type:"POST",url:"/api/userdata",data:{uid:app.uid},success:function(a){try{var e=a.data.accountId;e&&null!=e&&""!=e||(layer.msg("去个人中心添加昵称"),setTimeout(function(){},1500))}catch(i){layer.msg("去个人中心添加昵称"),setTimeout(function(){},1500)}}})},activeGetInfo:function(){app.accountId&&$.ajax({type:"POST",url:"/api/active_getinfo",data:{accountId:app.accountId},success:function(a){try{app.binfo=a.data}catch(e){}}})},getlrecentlylist_10:function(){$.ajax({type:"POST",url:"/api/geTenWinningList",data:{boxId:app.boxId},success:function(a){try{app.prize10=a.data,$("#scrollmessage ul").html("");for(var e="",i=0;i<app.prize10.length;i++)e=e+'<li><p><span class="sever">'+app.prize10[i].nickName+'</span><span class="name">  </span> 抽到 <span class="jiang"> '+app.prize10[i].prizeName+' </span> <span class="gang">'+app.prize10[i].time.substring(5,16)+"</span></p></li>";$("#scrollmessage ul").html(e)}catch(t){}}})},getPrizeListData:function(){$.ajax({type:"POST",url:"/api/getPrizeListData",data:{boxId:app.boxId},success:function(a){try{app.prizeList=a.data,setTimeout(function(){app.initBox(a.data)},6e3)}catch(e){}}})},initBox:function(a){function e(e){var i=a[e].orderId;$(".spades").eq(e).addClass("fanpai"),$(".spades").eq(e).removeClass("fanpai").addClass("fanpai1"),$(".spades").eq(e).find(".face").addClass("background80"),$(".spades").eq(e).find(".face").css("background-image","url(../../static/imgs_static/fanpai/jiang/"+jiangpin[i]+".png)"),setTimeout(function(){$(".title").addClass("titlestyle"),$(".title").eq(e).html(a[e].prizeName),e>=8?app.duobaoflag=1:app.duobaoflag=0},500)}if(!a)return layer.msg("数据异常，稍后重试！"),!1;$(".spades").addClass("fanpai2");for(var i=0;i<9;i++)e(i)},startPrize:function(){var a=0;$(".spades").click(function(){if(1!=app.duobaoflag)return layer.msg("正在洗牌！"),!1;if(0!=app.congxinxipai)return layer.msg("重新夺宝"),!1;if($(".card").hasClass("fanpai1"))return layer.msg("点击夺宝"),!1;if(0!=a)return!1;var e=$(this).index(),i=$(this);if(app.prizeDIV=e,app.binfo.personQuota<288)return layer.msg("柠檬点不足！"),setTimeout(function(){location.href="/usercenter?congzhi=ok"},1e3),!1;if($(this).hasClass("fanpaisign"))return layer.msg("该张牌已经被抽过！"),!1;var t=0,n=setInterval(function(){30==t&&(layer.msg("网络异常,请稍候再试！"),setTimeout(function(){window.location.reload()},3e3)),t+=1},1e3);a=1,$.ajax({type:"POST",url:"/api/startLuckDrawData",data:{accountId:app.accountId,boxId:app.boxId,lotteryType:"2"},success:function(e){if(console.log(e),"error_goto_user"==e&&(layer.msg("登录出现异常，请重新登录！"),util.delCookie("squid"),util.delCookie("token"),util.delCookie("accountId_shequ"),setTimeout(function(){location.href="/yinling"},1e3)),300==e.resultCode)return layer.msg(e.resultMsg),setTimeout(function(){window.location.reload()},2e3),!1;try{var t=e.data.prizeId;if("number"==typeof t){$(".card").css("opacity","0"),i.css("opacity","1"),i.addClass("fanpai"),i.addClass("fanpaisign"),setTimeout(function(){i.removeClass("fanpai").addClass("fanpai1")},500);var s="";setTimeout(function(){i.find(".face").attr("prizeName",e.data.prizeName);var a=prizeID[t];a=jiangpin[a],i.addClass("fanpai2"),i.attr("orderid",prizeID[t]),i.find(".face").addClass("background80"),i.find(".title").addClass("titlestyle"),i.find(".title").html(e.data.prizeName),s="../../static/imgs_static/fanpai/jiang/"+a+".png",i.find(".face").css("background-image","url("+s+")"),i.css({transform:" "+i[0].style.transform+" rotate3d(0, 1, 0, 180deg) scale(1.05,1.05)"})},100),setTimeout(function(){i.css({transform:" "+i[0].style.transform+" rotate3d(0, 1, 0, 180deg) scale(1.0,1.0)"})},200),setTimeout(function(){$(".card").css("opacity","1")},700),app.prizeName=e.data.prizeName,setTimeout(function(){clearInterval(n);var a=app.distinguishDistribution(t);"1"==a||"2"==a?($("#showimgBigName").html("恭喜抽中了"+e.data.prizeName),$("#gainingmask3 img").attr("src",s),$("#gainingmask3").show()):($("#showimgBigName1").html("恭喜抽中了"+e.data.prizeName),$("#gainingmask1 img").attr("src",s),$("#gainingmask1").show())},1e3),a=0,app.congxinxipai=1,app.activeGetInfo(),app.getlrecentlylist_10(),setTimeout(function(){app.allFanpai(t)},1e3),app.WXshare()}}catch(p){layer.msg("出现异常！"),a=0}},error:function(a){console.log(a),layer.msg("网络出现错误，请稍后再试！")}})})},distinguishDistribution:function(a){try{for(var e=0;e<app.prizeList.length;e++)if(app.prizeList[e].prizeId==a)return app.prizeList[e].prizeType}catch(i){}},chouwanxipai:function(){return 1!=app.duobaoflag?(layer.msg("正在洗牌！"),!1):(app.duobaoflag=0,$(".title").html(""),$(".title").removeClass("titlestyle"),$(".face").removeClass("background80"),app.congxinxipai=0,$(".card ").removeClass("fanpai1 fanpaisign fanpai fanpai2"),deck.fan(),$(".face").css("background-image","url(../../static/imgs_static/fanpai/card.png)"),deck.shuffle(),deck.shuffle(),deck.poker(),void setTimeout(function(){app.duobaoflag=1},4e3))},allFanpai:function(a){function e(a){if($(".spades").eq(a).hasClass("fanpaisign"));else{var e=app.prizeList[a].orderId;$(".spades").eq(a).addClass("fanpai"),$(".spades").eq(a).removeClass("fanpai").addClass("fanpai1"),$(".spades").eq(a).find(".face").addClass("background80"),$(".spades").eq(a).find(".face").css("background-image","url(../../static/imgs_static/fanpai/jiang/"+jiangpin[e]+".png)"),setTimeout(function(){if($(".title").addClass("titlestyle"),$(".title").eq(a).html(app.prizeList[a].prizeName),$(".fanpaisign .face").attr("prizename")==app.prizeList[a].prizeName){var e=Number(app.prizeDIV)+1;$(".spades").eq(a).find(".face").css("background-image","url(../../static/imgs_static/fanpai/jiang/"+jiangpin[e]+".png)"),$(".title").eq(a).html(app.prizeList[app.prizeDIV].prizeName)}},1)}a>=8?app.duobaoflag=1:app.duobaoflag=0}$(".spades").addClass("fanpai2");for(var i=0;i<9;i++)e(i)},WXshare:function(){var a=app.getDevice(),e=encodeURIComponent(location.href.split("#")[0]);$.ajax({type:"POST",url:"/api/shareaddSign",data:{appId:"20019",url:e,appKey:"71599476762ca9835879f4d188919549",allianceId:a},success:function(a){a&&0==a.status&&wx.config({debug:!1,appId:"wx90ea8be0c05b9630",timestamp:a.data.timestamp,nonceStr:a.data.nonceStr,signature:a.data.signature,jsApiList:["onMenuShareQZone","checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","getNetworkType","hideOptionMenu","showOptionMenu","closeWindow","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","scanQRCode","chooseWXPay"]}),wx.ready(function(){""!=app.prizeName?app.desc="我在福利社夺宝中夺得"+app.prizeName+",次元深海大和绝版皮肤,各种周边实物奖励等你来拿":app.desc="次元深海大和绝版皮肤,各种周边实物奖励等你来拿";var a=location.href.split("/topic/active2")[0],e=location.href.split("/topic/active2")[0]+"/static/imgs_static/share/share_dh.png",i={title:"超给力的夺宝福利",desc:app.desc,link:a+"/users/sharefuli",imgUrl:e,type:"link",dataUrl:"",success:function(){$(".sharemask").hide()},cancel:function(){}};wx.onMenuShareQZone(i),wx.onMenuShareAppMessage(i),wx.onMenuShareTimeline(i),wx.onMenuShareQQ(i)})},error:function(a){console.log(a)}})}}});app.init(),$(document).ready(function(){$("#gainingmask3 .gbtn3").click(function(){$("#gainingmask3").hide(),app.chouwanxipai()}),$("#gainingmask1 .gbtn3").click(function(){$("#gainingmask1").hide(),app.chouwanxipai()}),$(".showimgBig").click(function(){$(".showimgBig").hide()})});var jiangpin={1:"ps4",2:"shdh",3:"wlwp",4:"baozhen",5:"jdEcard",6:"Qcard",7:"nm500",8:"expX2greenzhanghao",9:"expX2purplehero"},prizeID={39:"1",30:"2",48:"3",32:"4",19:"5",20:"6",45:"7",55:"8",56:"9"};