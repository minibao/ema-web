var wxpay=new Vue({el:"#wxpay",data:{uid:"",wxcode:"",openid:"",orderId:"",amount:"",pid:"NM_0001",appKey:"71599476762ca9835879f4d188919549",appId:"20019",quantity:""},methods:{getWxPayAccessToken:function(){$.ajax({type:"POST",url:"/api/getWxPayAccessToken",data:{WXcode:wxpay.wxcode},success:function(a){console.log(a);try{wxpay.openid=a.openid,util.setCookie("wxopenid",wxpay.openid),wxpay.createOrderSociety()}catch(e){}},error:function(a){}})},createOrderSociety:function(){wxpay.uid&&$.ajax({type:"POST",url:"/api/createOrderData",data:{uid:wxpay.uid,appId:wxpay.appId,pid:wxpay.pid,quantity:util.getCookie("quantity"),appKey:wxpay.appKey},success:function(a){try{wxpay.gameTransCode=a.data.orderId,wxpay.timestamp=a.data.time,wxpay.createOrder()}catch(e){}}})},createOrder:function(){wxpay.uid&&$.ajax({type:"POST",url:"/api/createOrder",data:{uid:wxpay.uid,appId:wxpay.appId,pid:wxpay.pid,quantity:util.getCookie("quantity"),gameTransCode:wxpay.gameTransCode,appKey:wxpay.appKey},success:function(a){try{a.data.orderId&&(wxpay.orderId=a.data.orderId,wxpay.createWXOrder())}catch(e){}}})},createWXOrder:function(){var a=encodeURIComponent(location.href.split("#")[0]);$.ajax({type:"POST",url:"/api/shareaddSign",data:{appId:"20019",url:a,appKey:"71599476762ca9835879f4d188919549",allianceId:"71"},success:function(a){console.log(a),a&&0==a.status&&$.ajax({type:"POST",url:"/api/createWXOrder",data:{uid:wxpay.uid,appId:wxpay.appId,orderId:wxpay.orderId,amount:util.getCookie("quantity"),openId:wxpay.openid,tradeType:"JSAPI",ip:location.href.split("#")[0]},success:function(a){console.log(a);try{wx.ready(function(){wx.chooseWXPay({timestamp:a.data.timeStamp,nonceStr:a.data.nonceStr,"package":a.data["package"],signType:"MD5",paySign:a.data.sign,success:function(a){a&&(location.href="/usercenter")}})})}catch(e){}},error:function(a){}})},error:function(a){console.log(a)}})},getuserinfo:function(){$.ajax({type:"POST",url:"/api/active_getinfo",data:{accountId:""},success:function(a){try{$("#nmpot").html(a.data.personQuota)}catch(e){}}})}}});wxpay.uid=util.getCookie("squid"),""!=util.getUrlParams("code")&&util.getUrlParams("code")&&(wxpay.wxcode=util.getUrlParams("code"),wxpay.getWxPayAccessToken()),$(document).ready(function(){$("#wxpaybtn").click(function(){wxpay.quantity=$("#jingying_num").val(),wxpay.quantity=util.trim(wxpay.quantity),console.log(wxpay.quantity),""==wxpay.quantity?(wxpay.quantity=1,util.setCookie("quantity","1")):util.setCookie("quantity",wxpay.quantity),""!=wxpay.openid&&wxpay.openid?wxpay.createOrderSociety():window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx90ea8be0c05b9630&redirect_uri=https%3a%2f%2fsocial.lemonade-game.com/usercenter/wxpay?showpay=ok&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"})});