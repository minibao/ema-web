var app=new Vue({el:"#app",data:{accountId:"",binfo:"",prize10:"",boxId:"",prizeList:"",lotteryType:"1",uid:"",uinfo:"",click:!0,isBegin:!1},methods:{getuserinfo:function(){app.accountId&&$.ajax({type:"POST",url:"/api/active_getinfo",data:{accountId:app.accountId},success:function(e){try{app.binfo=e.data}catch(a){}}})},getuserdata:function(){app.uid&&$.ajax({type:"POST",url:"/api/userdata",data:{uid:app.uid},success:function(e){try{console.log(e),app.uinfo=e.data,app.accountId=app.uinfo.accountId,app.getuserinfo(),app.accountId||(layer.msg("去个人中心添加昵称"),setTimeout(function(){location.href="/usercenter?accound=kong"},1500))}catch(a){layer.msg("去个人中心添加昵称"),setTimeout(function(){location.href="/usercenter?accound=kong"},1500)}}})},getlrecentlylist_10:function(){$.ajax({type:"POST",url:"/api/geTenWinningList",data:{boxId:app.boxId},success:function(e){try{app.prize10=e.data,$("#scrollmessage ul").html("");for(var a="",i=0;i<app.prize10.length;i++)a=a+'<li><p><span class="sever">'+app.prize10[i].nickName+'</span><span class="name">  </span> 抽到 <span class="jiang"> '+app.prize10[i].prizeName+' </span> <span class="gang">'+app.prize10[i].time.substring(5,16)+"</span></p></li>";$("#scrollmessage ul").html(a)}catch(t){}}})},getPrizeListData:function(){app.boxId&&$.ajax({type:"POST",url:"/api/getPrizeListData",data:{boxId:app.boxId},success:function(e){try{app.prizeList=e.data,luck.loadingjiangping(app.prizeList)}catch(a){}}})},chooseTicket:function(){$("#commonTicket").addClass("box-shadow1"),$("#commonTicket").click(function(){var e=$(this).hasClass("box-shadow1");e?$(this).removeClass("box-shadow1"):($("#seniorTicket").removeClass("box-shadow1"),$(this).addClass("box-shadow1"),app.lotteryType="1")}),$("#seniorTicket").click(function(){var e=$(this).hasClass("box-shadow1");e?$(this).removeClass("box-shadow1"):($("#commonTicket").removeClass("box-shadow1"),$(this).addClass("box-shadow1"),app.lotteryType="2")})},minStartshake:function(e,a){$("#gainingmask2").show(),window.w=$(".num").width(),w=Math.floor(w),window.h=1.5*w,$(".num").css("width",w+"px"),$(".num").css("height",h+"px");var i=window.h;if(app.isBegin)return!1;if(app.isBegin=!0,$(".num").css("backgroundPositionY",0),!app.click)return console.log("点击被屏蔽"),!1;var t=a,n=t,o=n;if(o=o.toString(),o.length<4){for(var s=o.length;s<4;s++)o="0"+o;n=o}console.log(n);var c=(n+"").split("");$(".num").each(function(e){var a=$(".num").eq(3-e);setTimeout(function(){setTimeout(function(){a.animate({backgroundPositionY:60*i-i*c[3-e]},{duration:6e3+3e3*e,easing:"easeInOutCirc",complete:function(){3==e&&(app.click=!0,app.isBegin=!1,$(".gainingmask2 .btn").show(),$("#min-shake").html(t),app.getuserinfo())}})},30*e)},5e3)})},startPrize:function(){luck.init("luck"),$("#btn").click(function(){var e=$(".quan").hasClass("box-shadow1");if(e){if($("body").bind("touchmove",function(e){e.preventDefault()}),click)return console.log("点击被屏蔽"),!1;var a=0,i=setInterval(function(){30==a&&(layer.msg("网络异常,请稍候再试！"),setTimeout(function(){window.location.reload()},3e3)),a+=1},1e3);if(console.log("点击没屏蔽"),1==app.lotteryType){var t=$("#commonno").html();if("0张"==t)return $("body").unbind("touchmove"),layer.msg("该类型的券已经用完！"),!1}if(2==app.lotteryType){var n=$("#seniorno").html();if(console.log(n),"0张"==n)return $("body").unbind("touchmove"),layer.msg("该类型的券已经用完！"),!1}return $.ajax({type:"POST",url:"/api/startLuckDrawData",data:{accountId:app.accountId,boxId:app.boxId,lotteryType:app.lotteryType},success:function(e){"error_goto_user"==e&&(layer.msg("登录出现异常，请重新登录！"),util.delCookie("squid"),util.delCookie("token"),util.delCookie("accountId_shequ"),setTimeout(function(){location.href="/users"},1e3)),300==e.resultCode&&alert(JSON.stringify(e));var a;try{console.log(e.data);var t=e.data.prizeId;if(console.log(t),"0"!=t&&(a=Math.floor(10*Math.random())),console.log(a),a<5)var n=$(".luck-unit[prizeid = "+t+" ]").eq(0).attr("orderid");else if(a>=5)var n=$(".luck-unit[prizeid = "+t+" ]").eq(1).attr("orderid");if("undefined"==typeof n)var n=$(".luck-unit[prizeid = "+t+" ]").eq(0).attr("orderid");var o=$(".luck-unit[prizeid = "+t+" ]").attr("prizename");luck.prize=n-1;var s=setInterval(function(){if(0==luck.times){if("0"!=t&&"1"!=t){var e=$(".luck-unit[prizeid = "+t+" ]").find("img").attr("src");$(".gbtn1").show(),$("#prizedot").html("恭喜你中了"+o),$("#gainingmask").show(),$("#showprizeimg").attr("src",e),$("#showprizeimg").show()}else"1"==t?$("#gainingmask2").css("opacity","1"):"0"==t&&($("#prizedot").html(o),$("#gainingmask").show(),$(".gbtn1").hide(),$("#tks").show());clearInterval(s),clearInterval(i),$("body").unbind("touchmove")}},10);"1"==t&&($("#gainingmask2").css("opacity","0"),app.minStartshake(o,e.data.personalQuota)),app.getuserinfo(),app.getlrecentlylist_10()}catch(c){}}}),luck.speed=100,roll(),click=!0,!1}return layer.msg("请先选择一张券！"),!1})},uploadimg:function(){},WXshare:function(){var e=util.getDevice(),a=encodeURIComponent(location.href.split("#")[0]);$.ajax({type:"POST",url:"/api/shareaddSign",data:{appId:"20019",url:a,appKey:"71599476762ca9835879f4d188919549",allianceId:e},success:function(e){console.log(e),e&&0==e.status&&wx.config({debug:!1,appId:"wx90ea8be0c05b9630",timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,signature:e.data.signature,jsApiList:["onMenuShareQZone","checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","getNetworkType","hideOptionMenu","showOptionMenu","closeWindow","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","scanQRCode","chooseWXPay"]}),wx.ready(function(){var e=util.getlocalhostPath()+"/users/sharefuli",a=util.getlocalhostPath()+"/static/imgs_static/share/sharelogo1.png",i={title:"玩游戏现金奖品等你来拿",desc:"现金奖品等你来拿",link:e,imgUrl:a,type:"link",dataUrl:"",success:function(){},cancel:function(){}};wx.onMenuShareQZone(i),wx.onMenuShareAppMessage(i),wx.onMenuShareTimeline(i),wx.onMenuShareQQ(i)})},error:function(e){console.log(e)}})},battleSendLottery:function(){$.ajax({type:"POST",url:"/api/battleSendLottery",data:{key:""},success:function(e){try{console.log(e)}catch(a){}}})}}});app.uid=util.getCookie("squid"),app.uid?app.getuserdata():window.location.href="/users/sharefuli",app.accountId=util.getCookie("accountId_shequ"),app.boxId="10",app.getlrecentlylist_10(),app.getPrizeListData(),app.chooseTicket(),app.startPrize(),app.WXshare(),$("#addS-close").click(function(){$(".addSenior").hide()}),$("#btn-addpfb").click(function(){adds.getuserdata()}),$(".gainingmask .gbtn").click(function(){$("#min-shake").html(""),$("#gainingmask2 .btn").hide(),$(".gainingmask").hide(),$("#tks").hide(),$("#showprizeimg").hide(),$("#btn").trigger("click")}),$(".rulebox").click(function(){$(".rulebox").hide()}),$(".rule").click(function(){$(".rulebox").show()}),$("#gotoprize").click(function(){util.setCookie("showprize","show"),location.href="/usercenter"}),$(".luck-unit").click(function(){var e=$(this);console.log(e);var a=e.find("img").attr("src");$("#gainingmask3").show(),$("#showimgBigName").html(e.attr("prizename")),$("#gainingmask3 img").attr("src",a)}),$(".gbtn3").click(function(){$("#gainingmask3").hide()}),$(".showimgBig").click(function(){$(".showimgBig").hide()}),$(".gainingmask").click(function(){$(".gainingmask").hide()}),$("#getcard").click(function(){location.href="/users/yinlingcast"});